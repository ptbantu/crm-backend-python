#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
修复 seed_data.sql 文件中的编码乱码问题
"""
import re
import sys

# 正确的组织领域名称映射
ORGANIZATION_DOMAINS_FIX = {
    'æ³•åŠ¡é¢†åŸŸ': '法务领域',
    'å·¥åŽ‚é¢†åŸŸ': '工厂领域',
    'è´¸æ˜"é¢†åŸŸ': '贸易领域',
    'ç‰©æµé¢†åŸŸ': '物流领域',
    'é‡'èž'é¢†åŸŸ': '金融领域',
    'ç§'æŠ€é¢†åŸŸ': '科技领域',
    'æ•™è‚²é¢†åŸŸ': '教育领域',
    'åŒ»ç–—é¢†åŸŸ': '医疗领域',
    'æˆ¿åœ°äº§é¢†åŸŸ': '房地产领域',
    'æ—…æ¸¸é¢†åŸŸ': '旅游领域',
}

# 正确的描述映射
ORGANIZATION_DOMAINS_DESC_FIX = {
    'æ³•å¾‹ç›¸å…³æœ'åŠ¡': '法律相关服务',
    'å·¥åŽ‚ç›¸å…³æœ'åŠ¡': '工厂相关服务',
    'è´¸æ˜"ç›¸å…³æœ'åŠ¡': '贸易相关服务',
    'ç‰©æµç›¸å…³æœ'åŠ¡': '物流相关服务',
    'é‡'èž'ç›¸å…³æœ'åŠ¡': '金融相关服务',
    'ç§'æŠ€ç›¸å…³æœ'åŠ¡': '科技相关服务',
    'æ•™è‚²ç›¸å…³æœ'åŠ¡': '教育相关服务',
    'åŒ»ç–—ç›¸å…³æœ'åŠ¡': '医疗相关服务',
    'æˆ¿åœ°äº§ç›¸å…³æœ'åŠ¡': '房地产相关服务',
    'æ—…æ¸¸ç›¸å…³æœ'åŠ¡': '旅游相关服务',
}

# 权限名称修复映射（常见的乱码模式）
PERMISSIONS_FIX = {
    'åˆ›å»ºç"¨æˆ·': '创建用户',
    'æŸ¥çœ‹ç"¨æˆ·': '查看用户',
    'æ›´æ–°ç"¨æˆ·': '更新用户',
    'åˆ é™¤ç"¨æˆ·': '删除用户',
    'ç"¨æˆ·åˆ—è¡¨': '用户列表',
    'é"å®šç"¨æˆ·': '锁定用户',
    'åˆ›å»ºç»„ç»‡': '创建组织',
    'æŸ¥çœ‹ç»„ç»‡': '查看组织',
    'æ›´æ–°ç»„ç»‡': '更新组织',
    'åˆ é™¤ç»„ç»‡': '删除组织',
    'ç»„ç»‡åˆ—è¡¨': '组织列表',
    'é"å®šç»„ç»‡': '锁定组织',
    'åˆ›å»ºè§'è‰²': '创建角色',
    'æŸ¥çœ‹è§'è‰²': '查看角色',
    'æ›´æ–°è§'è‰²': '更新角色',
    'åˆ é™¤è§'è‰²': '删除角色',
    'è§'è‰²åˆ—è¡¨': '角色列表',
    'åˆ†é…'è§'è‰²': '分配角色',
    'æŸ¥çœ‹æ'ƒé™'': '查看权限',
    'ç®¡ç'†æ'ƒé™'': '管理权限',
    'æŸ¥çœ‹è"œå'': '查看菜单',
    'ç®¡ç'†è"œå'': '管理菜单',
    'åˆ›å»ºçº¿ç´¢': '创建线索',
    'æŸ¥çœ‹çº¿ç´¢': '查看线索',
    'æ›´æ–°çº¿ç´¢': '更新线索',
    'çº¿ç´¢åˆ—è¡¨': '线索列表',
    'è½¬åŒ–å•†æœº': '转化商机',
    'åˆ›å»ºå•†æœº': '创建商机',
    'æŸ¥çœ‹å•†æœº': '查看商机',
    'æ›´æ–°å•†æœº': '更新商机',
    'å•†æœºåˆ—è¡¨': '商机列表',
    'æŽ¥æ"¶è®¢å'': '接收订单',
    'æŸ¥çœ‹è®¢å'': '查看订单',
    'æ›´æ–°è®¢å'': '更新订单',
    'è®¢å'åˆ—è¡¨': '订单列表',
    'åˆ†é…'è®¢å'': '分配订单',
    'è·Ÿè¸ªè®¢å'': '跟踪订单',
    'ä¸Šä¼ æ–‡ä»¶': '上传文件',
    'æŸ¥çœ‹åº"æ"¶': '查看应收',
    'ç®¡ç'†åº"æ"¶': '管理应收',
    'æŸ¥çœ‹åº"ä»˜': '查看应付',
    'ç®¡ç'†åº"ä»˜': '管理应付',
    'æŸ¥çœ‹æŠ¥è¡¨': '查看报表',
    'å¯¼å‡ºæŠ¥è¡¨': '导出报表',
}

# 权限描述修复映射
PERMISSIONS_DESC_FIX = {
    'åˆ›å»ºæ–°ç"¨æˆ·': '创建新用户',
    'æŸ¥çœ‹ç"¨æˆ·è¯¦æƒ…': '查看用户详情',
    'æ›´æ–°ç"¨æˆ·ä¿¡æ'¯': '更新用户信息',
    'åˆ é™¤ç"¨æˆ·ï¼ˆé"å®šï¼‰': '删除用户（锁定）',
    'æŸ¥çœ‹ç"¨æˆ·åˆ—è¡¨': '查看用户列表',
    'é"å®š/è§£é"ç"¨æˆ·': '锁定/解锁用户',
    'åˆ›å»ºæ–°ç»„ç»‡': '创建新组织',
    'æŸ¥çœ‹ç»„ç»‡è¯¦æƒ…': '查看组织详情',
    'æ›´æ–°ç»„ç»‡ä¿¡æ'¯': '更新组织信息',
    'åˆ é™¤ç»„ç»‡ï¼ˆé"å®šï¼‰': '删除组织（锁定）',
    'æŸ¥çœ‹ç»„ç»‡åˆ—è¡¨': '查看组织列表',
    'é"å®š/è§£é"ç»„ç»‡': '锁定/解锁组织',
    'åˆ›å»ºæ–°è§'è‰²': '创建新角色',
    'æŸ¥çœ‹è§'è‰²è¯¦æƒ…': '查看角色详情',
    'æ›´æ–°è§'è‰²ä¿¡æ'¯': '更新角色信息',
    'åˆ é™¤è§'è‰²': '删除角色',
    'æŸ¥çœ‹è§'è‰²åˆ—è¡¨': '查看角色列表',
    'ä¸ºç"¨æˆ·åˆ†é…'è§'è‰²': '为用户分配角色',
    'æŸ¥çœ‹æ'ƒé™'åˆ—è¡¨': '查看权限列表',
    'ç®¡ç'†æ'ƒé™'é…'ç½®': '管理权限配置',
    'æŸ¥çœ‹è"œå'é…'ç½®': '查看菜单配置',
    'ç®¡ç'†è"œå'é…'ç½®': '管理菜单配置',
    'åˆ›å»ºæ–°çº¿ç´¢': '创建新线索',
    'æŸ¥çœ‹çº¿ç´¢è¯¦æƒ…': '查看线索详情',
    'æ›´æ–°çº¿ç´¢ä¿¡æ'¯': '更新线索信息',
    'æŸ¥çœ‹çº¿ç´¢åˆ—è¡¨': '查看线索列表',
    'å°†çº¿ç´¢è½¬åŒ–ä¸ºå•†æœº': '将线索转化为商机',
    'åˆ›å»ºæ–°å•†æœº': '创建新商机',
    'æŸ¥çœ‹å•†æœºè¯¦æƒ…': '查看商机详情',
    'æ›´æ–°å•†æœºä¿¡æ'¯': '更新商机信息',
    'æŸ¥çœ‹å•†æœºåˆ—è¡¨': '查看商机列表',
    'æŽ¥æ"¶æ–°è®¢å'': '接收新订单',
    'æŸ¥çœ‹è®¢å'è¯¦æƒ…': '查看订单详情',
    'æ›´æ–°è®¢å'ä¿¡æ'¯': '更新订单信息',
    'æŸ¥çœ‹è®¢å'åˆ—è¡¨': '查看订单列表',
    'åˆ†é…'è®¢å'ç»™å'šå'äººå'˜': '分配订单给做单人员',
    'è·Ÿè¸ªè®¢å'è¿›åº¦': '跟踪订单进度',
    'ä¸Šä¼ è®¢å'ç›¸å…³æ–‡ä»¶': '上传订单相关文件',
    'æŸ¥çœ‹åº"æ"¶è´¦æ¬¾': '查看应收账款',
    'ç®¡ç'†åº"æ"¶è´¦æ¬¾': '管理应收账款',
    'æŸ¥çœ‹åº"ä»˜è´¦æ¬¾': '查看应付账款',
    'ç®¡ç'†åº"ä»˜è´¦æ¬¾': '管理应付账款',
    'æŸ¥çœ‹è´¢åŠ¡æŠ¥è¡¨': '查看财务报表',
    'å¯¼å‡ºè´¢åŠ¡æŠ¥è¡¨': '导出财务报表',
}

# 角色名称修复映射
ROLES_FIX = {
    'ç®¡ç'†å'˜': '管理员',
    'é"€å"®': '销售',
    'æ¸ é'“ä»£ç'†': '渠道代理',
    'è¿'è¥å'äººå'˜': '做单人员',
    'è´¢åŠ¡': '财务',
}

# 角色描述修复映射
ROLES_DESC_FIX = {
    'ç³»ç»Ÿç®¡ç'†å'˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æ'ƒé™'': '系统管理员，拥有所有权限',
    'å†…éƒ¨é"€å"®ä»£è¡¨': '内部销售代表',
    'å¤–éƒ¨æ¸ é'“ä»£ç'†é"€å"®': '外部渠道代理销售',
    'è®¢å'å¤„ç'†äººå'˜': '订单处理人员',
    'è´¢åŠ¡äººå'˜ï¼Œè´Ÿè´£åº"æ"¶åº"ä»˜å'ŒæŠ¥è¡¨': '财务人员，负责应收应付和报表',
}

def fix_encoding(text):
    """修复文本中的编码乱码"""
    # 修复组织领域
    for wrong, correct in ORGANIZATION_DOMAINS_FIX.items():
        text = text.replace(wrong, correct)
    for wrong, correct in ORGANIZATION_DOMAINS_DESC_FIX.items():
        text = text.replace(wrong, correct)
    
    # 修复权限
    for wrong, correct in PERMISSIONS_FIX.items():
        text = text.replace(wrong, correct)
    for wrong, correct in PERMISSIONS_DESC_FIX.items():
        text = text.replace(wrong, correct)
    
    # 修复角色
    for wrong, correct in ROLES_FIX.items():
        text = text.replace(wrong, correct)
    for wrong, correct in ROLES_DESC_FIX.items():
        text = text.replace(wrong, correct)
    
    return text

def main():
    input_file = "/home/bantu/crm-backend-python/init-scripts/seed_data.sql"
    output_file = "/home/bantu/crm-backend-python/init-scripts/seed_data.sql"
    
    print(f"📄 读取文件: {input_file}")
    with open(input_file, 'r', encoding='utf-8') as f:
        content = f.read()
    
    print("🔧 修复编码乱码...")
    fixed_content = fix_encoding(content)
    
    if fixed_content != content:
        print("✅ 发现并修复了乱码")
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write(fixed_content)
        print(f"✅ 已保存修复后的文件: {output_file}")
    else:
        print("ℹ️  未发现需要修复的乱码")

if __name__ == '__main__':
    main()

